# Guide d'application des modifications pour StudentTrainingAgreement.tsx

## √âtapes √† suivre

1. **Ajouter les imports n√©cessaires**
   - Ajouter `import { SignatureType, DocumentType, getSignatureTypeFromString, isSealType, generateStandardSignatureFilename } from '../types/SignatureTypes';` apr√®s les imports existants (autour de la ligne 20).

2. **Mettre √† jour l'interface SignatureCacheItem**
   - Localiser l'interface `SignatureCacheItem` (vers la ligne 102)
   - Ajouter `representativeSig?: string | null;` juste avant la propri√©t√© `timestamp`

3. **Ajouter l'√©tat hasRepresentativeSignature**
   - Localiser la section des √©tats dans le composant StudentTrainingAgreement (vers la ligne 260)
   - Ajouter `const [hasRepresentativeSignature, setHasRepresentativeSignature] = useState(false);` pr√®s de l'√©tat `hasParticipantSignature`

4. **Ajouter la fonction safeSetRepresentativeSignature**
   - Chercher les autres fonctions safeSet comme safeSetParticipantSignature
   - Ajouter la fonction:
   ```typescript
   const safeSetRepresentativeSignature = useCallback((value: string | null) => {
     if (value || !signaturesLocked) {
       setRepresentativeSignature(value);
     } else {
       console.log('üîí [PROTECT] Tentative de d√©finir representativeSignature √† null bloqu√©e');
     }
   }, [signaturesLocked]);
   ```

5. **Mettre √† jour la fonction updateSignatureCache**
   - Localiser la fonction `updateSignatureCache` (vers la ligne 281)
   - Remplacer le type de fonction pour accepter `representativeSig` comme cinqui√®me param√®tre
   - Mettre √† jour le corps de la fonction pour inclure ce param√®tre dans le cache global et localStorage

6. **Remplacer la fonction handleSignatureSave**
   - Localiser la fonction `handleSignatureSave` (vers la ligne 1842)
   - Remplacer la fonction compl√®te par la version mise √† jour qui prend en charge le type 'representative'

7. **Remplacer la fonction loadSignaturesFromSupabase**
   - Localiser la fonction `loadSignaturesFromSupabase` (vers la ligne 770)
   - Remplacer la fonction compl√®te par la version mise √† jour qui charge les signatures de repr√©sentant

## V√©rification apr√®s mise √† jour

Apr√®s avoir appliqu√© toutes les modifications:

1. V√©rifier que le code compile sans erreurs
2. Tester le t√©l√©chargement et l'affichage des signatures de repr√©sentant l√©gal
3. V√©rifier que toutes les r√©f√©rences √† `updateSignatureCache` sont mises √† jour avec le nouveau format (5 param√®tres)
4. S'assurer que le cache et le stockage local g√®rent correctement le nouveau type de signature

## Probl√®mes potentiels

- Si les r√©f√©rences √† `updateSignatureCache` ne sont pas mises √† jour pour inclure le 5√®me param√®tre, ajouter `null` comme valeur par d√©faut
- V√©rifier que l'interface utilisateur inclut une option pour ajouter une signature de repr√©sentant l√©gal
- S'assurer que la table `document_signatures` de la base de donn√©es accepte le type 'representative' 